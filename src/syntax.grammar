@top Script { item* }

item {
  ProcDefinition |
  SetExpression |
  PackageCommand |
  IfStatement |
  WhileStatement |
  ForStatement |
  ForeachStatement |
  TryStatement |
  SwitchStatement |
  KeywordCommand |
  ProcInvocation |
  Block |
  QuotedString |
  Variable |
  CommandSub |
  LineComment
}

ProcInvocation {
  ProcInvocationName
}

ProcInvocationName { word }

KeywordCommand {
  TclKeyword
}

SetExpression {
  SetKeyword VarName SetValue
}

SetKeyword { setKeyword }

PackageCommand {
  PackageRequire |
  PackageProvide 
}

PackageRequire {
  packageKeyword requireKeyword PackageName
}

PackageProvide {
  packageKeyword provideKeyword PackageName PackageVersion
}

ProcDefinition {
  procKeyword ProcName "{" "}" ProcBody
}

ProcName { word }

PackageName { word }

PackageVersion { word }

VarName { word }

SetValue {
  Variable |
  CommandSub |
  word
}

TclKeyword {
  exprKeyword |
  putsKeyword |
  returnKeyword |
  breakKeyword |
  continueKeyword |
  globalKeyword |
  variableKeyword |
  uplevelKeyword |
  upvarKeyword |
  listKeyword |
  llengthKeyword |
  lindexKeyword |
  lappendKeyword |
  linsertKeyword |
  lreplaceKeyword |
  lsearchKeyword |
  lsortKeyword |
  joinKeyword |
  splitKeyword |
  stringKeyword |
  regexpKeyword |
  regsubKeyword |
  formatKeyword |
  scanKeyword |
  arrayKeyword |
  dictKeyword |
  incrKeyword |
  appendKeyword |
  unsetKeyword |
  infoKeyword |
  evalKeyword |
  sourceKeyword |
  exitKeyword |
  errorKeyword |
  catchKeyword |
  throwKeyword |
  namespaceKeyword |
  clockKeyword |
  fileKeyword |
  globKeyword |
  cdKeyword |
  pwdKeyword |
  openKeyword |
  closeKeyword |
  readKeyword |
  writeKeyword |
  getsKeyword |
  flushKeyword |
  seekKeyword |
  tellKeyword |
  eofKeyword |
  fconfigureKeyword |
  encodingKeyword |
  binaryKeyword |
  afterKeyword |
  updateKeyword |
  vwaitKeyword |
  traceKeyword |
  eqKeyword |
  neKeyword |
  ltKeyword |
  gtKeyword |
  leKeyword |
  geKeyword
}

ProcBody { Block }

IfStatement {
  ifKeyword Block Block ElseClause?
}

ElseClause {
  elseifKeyword Block Block ElseClause? |
  elseKeyword Block
}

WhileStatement {
  whileKeyword Block Block
}

ForStatement {
  forKeyword Block Block Block Block
}

ForeachStatement {
  foreachKeyword word Block Block
}

TryStatement {
  tryKeyword Block FinallyClause?
}

FinallyClause {
  finallyKeyword Block
}

SwitchStatement {
  switchKeyword Block Block
}

Block {
  "{" item* "}"
}


QuotedString { 
  "\"" quotedItem* "\""
}

quotedItem {
  quotedText |
  Variable |
  CommandSub
}


Variable { 
  "$" word 
}

CommandSub { 
  "[" item* "]" 
}

@tokens {
  
  LineComment { "#" ![\n\r]* }
  
  quotedText { ![\"\n\r$\[]+ }
  
  
  procKeyword { "proc" (" " | "\t") }
  
  // Core command keywords
  setKeyword { "set" }
  exprKeyword { "expr" }
  putsKeyword { "puts" }
  
  // Control flow keywords  
  ifKeyword { "if" }
  elseKeyword { "else" }
  elseifKeyword { "elseif" }
  whileKeyword { "while" }
  forKeyword { "for" }
  foreachKeyword { "foreach" }
  switchKeyword { "switch" }
  returnKeyword { "return" }
  breakKeyword { "break" }
  continueKeyword { "continue" }
  
  // Variable and scope keywords
  globalKeyword { "global" }
  variableKeyword { "variable" }
  uplevelKeyword { "uplevel" }
  upvarKeyword { "upvar" }
  
  // List manipulation keywords
  listKeyword { "list" }
  llengthKeyword { "llength" }
  lindexKeyword { "lindex" }
  lappendKeyword { "lappend" }
  linsertKeyword { "linsert" }
  lreplaceKeyword { "lreplace" }
  lsearchKeyword { "lsearch" }
  lsortKeyword { "lsort" }
  joinKeyword { "join" }
  splitKeyword { "split" }
  
  // String manipulation keywords
  stringKeyword { "string" }
  regexpKeyword { "regexp" }
  regsubKeyword { "regsub" }
  formatKeyword { "format" }
  scanKeyword { "scan" }
  
  // Array and dict keywords
  arrayKeyword { "array" }
  dictKeyword { "dict" }
  
  // Variable manipulation keywords
  incrKeyword { "incr" }
  appendKeyword { "append" }
  unsetKeyword { "unset" }
  
  // Introspection keywords
  infoKeyword { "info" }
  
  // Evaluation keywords
  evalKeyword { "eval" }
  sourceKeyword { "source" }
  
  // Program control keywords
  exitKeyword { "exit" }
  errorKeyword { "error" }
  catchKeyword { "catch" }
  tryKeyword { "try" ![a-zA-Z0-9_] }
  finallyKeyword { "finally" ![a-zA-Z0-9_] }
  throwKeyword { "throw" }
  
  // Namespace keywords
  namespaceKeyword { "namespace" }
  packageKeyword { "package" }
  requireKeyword { "require" }
  provideKeyword { "provide" }
  
  // System keywords
  clockKeyword { "clock" }
  fileKeyword { "file" }
  globKeyword { "glob" }
  cdKeyword { "cd" }
  pwdKeyword { "pwd" }
  
  // I/O keywords
  openKeyword { "open" ![a-zA-Z0-9_] }
  closeKeyword { "close" }
  readKeyword { "read" }
  writeKeyword { "write" }
  getsKeyword { "gets" }
  flushKeyword { "flush" }
  seekKeyword { "seek" }
  tellKeyword { "tell" }
  eofKeyword { "eof" }
  fconfigureKeyword { "fconfigure" }
  encodingKeyword { "encoding" }
  binaryKeyword { "binary" }
  
  // Event keywords
  afterKeyword { "after" }
  updateKeyword { "update" }
  vwaitKeyword { "vwait" }
  traceKeyword { "trace" }
  
  // Comparison operators
  eqKeyword { "eq" ![a-zA-Z0-9_] }
  neKeyword { "ne" ![a-zA-Z0-9_] }
  ltKeyword { "lt" ![a-zA-Z0-9_] }
  gtKeyword { "gt" ![a-zA-Z0-9_] }
  leKeyword { "le" ![a-zA-Z0-9_] }
  geKeyword { "ge" ![a-zA-Z0-9_] }
  
  word { (@asciiLetter | @digit | "_" | "-" | "." | "/")+ }
  
  @precedence { 
    procKeyword, 
    setKeyword,
    exprKeyword, putsKeyword,
    formatKeyword, ifKeyword, elseifKeyword, elseKeyword, whileKeyword, foreachKeyword, forKeyword, switchKeyword, returnKeyword, breakKeyword, continueKeyword,
    globalKeyword, variableKeyword, uplevelKeyword, upvarKeyword,
    listKeyword, llengthKeyword, lindexKeyword, lappendKeyword, linsertKeyword, lreplaceKeyword, lsearchKeyword, lsortKeyword, joinKeyword, splitKeyword,
    stringKeyword, regexpKeyword, regsubKeyword, scanKeyword,
    arrayKeyword, dictKeyword,
    incrKeyword, appendKeyword, unsetKeyword,
    infoKeyword, evalKeyword, sourceKeyword,
    exitKeyword, errorKeyword, catchKeyword, tryKeyword, finallyKeyword, throwKeyword,
    namespaceKeyword, packageKeyword, requireKeyword, provideKeyword,
    clockKeyword, fileKeyword, globKeyword, cdKeyword, pwdKeyword,
    openKeyword, closeKeyword, readKeyword, writeKeyword, getsKeyword, flushKeyword, seekKeyword, tellKeyword, eofKeyword, fconfigureKeyword, encodingKeyword, binaryKeyword,
    afterKeyword, updateKeyword, vwaitKeyword, traceKeyword,
    eqKeyword, neKeyword, ltKeyword, gtKeyword, leKeyword, geKeyword,
    word 
  }
}




